---
description: Phase 1 要件定義 - ユーザーとの対話でプロジェクト要件を明確化する
---

# Phase 1: 要件定義ワークフロー

## 目的・概要

このフェーズでは、ユーザー（施主）との**段階的な対話**を通じてプロジェクトの要件を明確化し、`docs/requirements.md` として文書化する。

**重要**: 最初から詳細を求めず、抽象的な質問から始めて徐々に深掘りしていく。ユーザーの負担を最小限に抑えつつ、本質的な要件を引き出すことを心がける。

---

## 担当者

| 役割 | 担当 |
|------|------|
| 主導 | AG（建築家） |
| 協力 | User（施主） |

---

## 前提条件

- [ ] ArchCraft基盤の初期化が完了していること
- [ ] `PRODUCT.md` を読み込み、現在のフェーズが Phase 1 であることを確認済み
- [ ] `ArchCraft.md` を読み込み、運用ルールを把握済み

---

## 対話フロー（段階的深掘り方式）

### Round 1: ビジョンの把握（最も抽象的）

まず大きな絵を描くために、以下を**1〜2問**で確認：

> 「どんなサービス/アプリを作りたいですか？一言で教えてください」
> 「誰のためのサービスですか？」

**ポイント:**
- 詳細は求めない
- ユーザーの言葉をそのまま受け取る
- この段階で仮のプロジェクト名を決めてもOK

---

### Round 2: 課題と価値の深掘り

Round 1 の回答を受けて、以下を確認：

> 「そのサービスで解決したい課題は何ですか？」
> 「ユーザーにとっての一番の価値は何だと思いますか？」

**ポイント:**
- 「なぜ？」を意識して深掘り
- 既存の解決策（競合）があれば聞いてみる

---

### Round 3: 主要機能の洗い出し

ここから具体的な機能に踏み込む：

> 「最低限必要な機能を挙げてください（目安として3〜5個くらい）」
> 「それぞれの機能について、もう少し詳しく教えてください」

**ポイント:**
- MVPの範囲を意識
- 「あれもこれも」にならないよう絞り込む
- 数はあくまで目安。2個で十分なら2個でOK

---

### Round 3.5: 機能の深掘り（各機能ごとに確認）

挙げられた各機能について、以下の観点で深掘りする：

| 観点 | 質問例 |
|------|--------|
| Who | 誰がこの機能を使いますか？（管理者/一般ユーザー/両方） |
| What(入力) | 何を入力・操作しますか？ |
| What(出力) | 結果として何が表示・保存されますか？ |
| When | いつ・どんな条件で使いますか？ |
| Status | 状態管理は必要ですか？（公開/非公開、有効/無効など） |

**ポイント:**
- すべての機能に同じテンプレートで質問し、粒度を揃える
- 曖昧な回答は具体例を求めて明確化する

---

### Round 4: 制約条件の確認

プロジェクトの現実的な制約を把握：

> 「予算や期間の制約はありますか？」
> 「使いたい技術や、避けたい技術はありますか？」
> 「個人開発ですか？チーム開発ですか？」

---

### Round 4.5: データモデルの確認

扱うデータの概要を把握する：

> 「この機能で扱う主なデータは何ですか？」
> 「そのデータにはどんな項目がありそうですか？」
> 「データ同士の関係はどうなっていますか？」

**例:**
- 「レシピには複数の材料が含まれる」→ 1対多
- 「ユーザーは複数のレシピをお気に入りできる」→ 多対多

**確認すべきポイント:**
- 主キーになりそうな項目（名前？ID？）
- 必須項目と任意項目
- 一意制約が必要な項目（メールアドレスなど）

---

### Round 4.6: 画面の洗い出し

必要な画面の概要を把握する：

> 「ざっくり、どんな画面が必要そうですか？」
> 「一覧画面と詳細画面は分けますか？」
> 「管理者用の画面は必要ですか？」

**画面リスト例:**
- [ ] ログイン画面
- [ ] ホーム/ダッシュボード
- [ ] 一覧画面（〇〇リスト）
- [ ] 詳細画面（〇〇詳細）
- [ ] 登録/編集画面
- [ ] 設定画面

---

### Round 5: 非機能要件チェックリスト

技術選定・設計に影響する観点を確認する。  
**「やらない」も立派な決定**。考えてなかったを防ぐために、明示的に確認する。

---

#### 5.1 テスト・品質

> 「テストはどこまでやりますか？」

| 選択肢 | 説明 |
|--------|------|
| 手動テストのみ | 自動テストなし。小規模なら許容 |
| ユニットテスト | ロジック部分のみ自動テスト |
| E2Eテスト | 画面操作を含む自動テスト（Playwright等） |
| CI必須 | PRごとにテスト実行を必須化 |

---

#### 5.2 アクセス解析・トラッキング

> 「アクセス解析は入れますか？」

| 選択肢 | 影響 |
|--------|------|
| 不要 | 何も入れない |
| GA4 | Google Analytics。Cookie同意バナーが必要になる可能性 |
| プライバシー重視型 | Plausible、Umami等。Cookie不要のものも |

---

#### 5.3 SEO

> 「SEO対策はどこまでやりますか？」

| 選択肢 | 技術選定への影響 |
|--------|-----------------|
| 不要 | SPA（CSR）でOK |
| 基本対応 | メタタグ、OGP、サイトマップ |
| 本格対応 | SSR/SSG必須（Next.js、Nuxt等の選択に影響） |

---

#### 5.4 アクセシビリティ

> 「アクセシビリティはどこまで担保しますか？」

| 選択肢 | 内容 |
|--------|------|
| 最低限 | セマンティックHTML、altテキスト程度 |
| WCAG 2.1 A | キーボード操作、コントラスト比など |
| WCAG 2.1 AA | より厳格な基準（公共系サービスでよく求められる） |

---

#### 5.5 レスポンシブ・デバイス対応

> 「どのデバイスに対応しますか？」

| 選択肢 | 備考 |
|--------|------|
| PCのみ | モバイル考慮なし |
| PC + スマホ | 一般的なレスポンシブ対応 |
| モバイルファースト | スマホ優先で設計 |
| ネイティブアプリ検討 | PWA or ReactNative等の検討 |

---

#### 5.6 多言語対応（i18n）

> 「多言語対応は必要ですか？」

| 選択肢 | 影響 |
|--------|------|
| 日本語のみ | 対応不要 |
| 将来的に検討 | 文言をハードコードしない設計にしておく |
| 初期から対応 | i18nライブラリ導入（react-intl、vue-i18n等） |

---

#### 5.7 認証方式

> 「ログイン機能が必要な場合、どの認証方式を使いますか？」

| 選択肢 | 備考 |
|--------|------|
| 認証不要 | 誰でもアクセス可能 |
| メール+パスワード | 従来型。パスワード管理が必要 |
| SNSログイン | Google、GitHub等。実装は楽だが審査が必要な場合も |
| パスワードレス | マジックリンク、Passkey等 |
| 認証サービス利用 | Firebase Auth、Auth0、Clerk等 |

---

#### 5.8 通知機能

> 「通知機能は必要ですか？」

| 選択肢 | 影響 |
|--------|------|
| 不要 | - |
| メール通知 | メール送信サービスが必要（SendGrid、Resend等） |
| プッシュ通知 | FCM等の導入。モバイルアプリなら必須検討 |
| アプリ内通知 | 通知管理のDB設計が必要 |

---

#### 5.9 監視・エラートラッキング

> 「エラー監視は入れますか？」

| 選択肢 | 備考 |
|--------|------|
| 不要 | 問題発生時に気づきにくい |
| Sentry等 | エラー発生時に通知。無料枠あり |
| ログ収集 | CloudWatch、Datadog等 |

---

#### 5.10 オフライン対応

> 「オフライン対応は必要ですか？」

| 選択肢 | 影響 |
|--------|------|
| 不要 | 常時オンライン前提 |
| PWA | Service Worker導入。キャッシュ戦略の設計が必要 |

---

#### 5.11 パフォーマンス目標

> 「パフォーマンスはどこまで気にしますか？」

| 選択肢 | 対応内容 |
|--------|---------|
| 気にしない | 最適化は後回し |
| 基本対応 | 画像最適化、遅延読み込み程度 |
| 本格対応 | LCP/FID/CLS目標設定、CDN導入 |

---

#### 5.12 データエクスポート・GDPR

> 「ユーザーデータのエクスポート機能は必要ですか？」

| 選択肢 | 備考 |
|--------|------|
| 不要 | 個人利用や国内向けなら不要なことが多い |
| 欲しい | データエクスポート機能の設計が必要 |
| GDPR対応必須 | EU向けサービスなら必須。削除権対応も |

---

**ポイント:**
- すべてに回答する必要はない。プロジェクトに関係ある項目だけ確認すればOK
- 「やらない」「後で考える」も明示的に決定として記録する
- 判断に迷う項目は「要検討」としてrequirements.mdに残す

---

## AGからの提案ルール

対話の中で、以下のような**提案**を行う：

### 提案を行うタイミング
- Round 3（主要機能確認）以降
- ユーザーの要件がある程度見えてきた段階

### 提案の観点
1. **関連機能の提案**: 「〜の機能があると、さらに便利になるかもしれません」
2. **代替案の提示**: 「〜という方法もありますが、どちらが良いですか？」
3. **リスクの指摘**: 「〜は実装コストが高いかもしれません。簡易版から始めるのはどうですか？」

### ⚠️ 提案時の注意事項

> **規模感を常に意識すること**

- 個人開発・無料枠優先の前提を忘れない
- 大規模な提案は避け、**MVP に収まる範囲**で提案する
- 「あったらいいね」程度の機能は**オプション**として分類
- 開発期間への影響を考慮する

**良い提案の例:**
- 「通知機能は最初はメールだけにして、後からプッシュ通知を追加する形はどうですか？」
- 「管理画面は最初は省略して、DBを直接操作する形でもいいかもしれません」

**避けるべき提案:**
- 「機械学習で〜」（規模が大きすぎる）
- 「マイクロサービスで〜」（個人開発には不向き）

---

## 対話の終了条件

以下が全て明確になったら、要件定義書の作成に移る：

### 必須条件
- [ ] プロジェクトの目的・ビジョンが明確
- [ ] ターゲットユーザーが特定されている
- [ ] MVP に含める機能が絞られている（目安3〜5個）
- [ ] 制約条件（予算・期間）が把握できている

### 設計移行前の追加確認
- [ ] 各機能のユーザー種別（誰が使うか）が明確
- [ ] 各機能の入力・出力が大まかに把握できている
- [ ] 主要なデータ項目がリストアップされている
- [ ] データ間の関連性（1対多、多対多）が把握できている
- [ ] 必要な画面の種類がざっくり列挙されている
- [ ] 状態管理が必要な項目が特定されている
- [ ] 非機能要件（テスト、SEO、認証方式など）が確認済み

---

## 成果物

| ファイル | 説明 |
|---------|------|
| `docs/requirements.md` | 要件定義書（このフェーズの最終成果物） |

### requirements.md 必須セクション

以下のセクションを必ず含めること：

```markdown
# 要件定義書

## 1. 概要
- プロジェクト名
- 目的・解決する課題
- ターゲットユーザー

## 2. 機能要件

### 機能名1
- **概要**: 機能の説明
- **対象ユーザー**: 誰が使うか
- **入力**: 何を入力するか
- **出力**: 何が表示・保存されるか
- **備考**: 状態管理、特記事項など

（以下、各機能について同様に記載）

## 3. 画面一覧（仮）

| 画面名 | 種別 | 対象ユーザー |
|--------|------|------------|
| ○○画面 | 一覧/詳細/入力 | 一般/管理者 |

## 4. データ項目一覧（仮）

| データ名 | 主な属性 | 関連 |
|---------|---------|------|
| ○○ | 名前、説明、... | △△と1対多 |

## 5. 非機能要件

確認済みの項目を記載（「対応しない」も明記）：

| 観点 | 決定 | 備考 |
|------|------|------|
| テスト | ユニットテスト/E2E/手動のみ | - |
| アクセス解析 | GA4/不要/その他 | - |
| SEO | 不要/基本/本格 | - |
| アクセシビリティ | 最低限/WCAG A/AA | - |
| デバイス対応 | PC/レスポンシブ/モバイルファースト | - |
| 多言語(i18n) | 不要/将来検討/初期対応 | - |
| 認証方式 | 不要/メール+PW/SNS/認証サービス | - |
| 通知 | 不要/メール/プッシュ | - |
| エラー監視 | 不要/Sentry等 | - |
| オフライン | 不要/PWA | - |
| パフォーマンス | 気にしない/基本/本格 | - |
| データエクスポート | 不要/対応/GDPR必須 | - |

## 6. 制約条件
- 予算・期間
- 技術制約
- その他

## 7. 将来的な拡張（スコープ外）
- MVP後に検討する機能
```

---

## CCレビュー（Claude Code による検証）

成果物作成後、Claude Code でレビューを実施する。

### 実行コマンド

```bash
claude -p "以下のファイルをレビューしてください。
対象: docs/requirements.md

レビュー観点:
1. 誤字脱字がないか
2. リスクがないか
3. 記載内容に不備がないか（漏れている情報がないか）
4. 技術的にあり得ないことを言っていないか
5. 職人としての目線で見て、全体的に問題がないドキュメントになっているか

問題があれば具体的に指摘してください。"
```

### レビュー結果の扱い

> ⚠️ **CCの指摘を鵜呑みにしないこと**
> Claude Code も AI なので、必ずしも正しい指摘とは限らない。

1. CCからの指摘を受け取る
2. **AGが指摘の妥当性を検証**する
   - 本当に問題か？
   - 修正が必要か？
   - 過剰な指摘ではないか？
3. 妥当な指摘のみ修正を実施
4. 判断に迷う場合はユーザーに相談

---

## 完了条件

- [ ] `docs/requirements.md` が作成されている
- [ ] 全ての必須項目が記載されている
- [ ] CCレビューが完了している
- [ ] ユーザーが要件定義書を承認している

---

## 次フェーズへの移行

1. `PRODUCT.md` の `Current Phase` を「Phase 2: 技術選定」に更新
2. `Status & Decisions` に要件定義完了を記録
3. **README.md の更新**（下記参照）
4. Phase 2 ワークフロー（`/phase-2-tech-stack`）を開始

---

## README.md の更新

Phase 1 完了時に `README.md` の概要セクションを更新する。

### 更新対象

```markdown
## 概要

> ⚠️ このセクションは Phase 1（要件定義）完了後に更新されます
```

↓ 以下のように置き換える：

### 更新内容

`docs/requirements.md` から以下の情報を抽出し、README.md に反映：

```markdown
## 概要

{プロジェクトの目的・解決する課題を2〜3文で記述}

### 主な機能

- {MVP機能1}
- {MVP機能2}
- {MVP機能3}

### 対象ユーザー

{ターゲットユーザーの説明}
```

### 例

```markdown
## 概要

カクテル作りを楽しむ人のためのレシピ管理アプリです。
自分のオリジナルレシピを登録・管理し、材料から逆引き検索ができます。

### 主な機能

- レシピの登録・編集・削除
- 材料からのレシピ検索
- お気に入り管理

### 対象ユーザー

自宅でカクテルを楽しむ個人ユーザー
```

