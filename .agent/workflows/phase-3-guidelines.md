---
description: Phase 3 ガイドライン策定 - コーディング規約と開発方針を定義する
---

# Phase 3: ガイドライン策定ワークフロー

## 目的・概要

このフェーズでは、Phase 2 で選定した技術スタックに基づいて、コーディング規約と開発方針を策定し、`docs/guidelines/` 配下に文書化する。

ガイドラインがあることで、コードの一貫性が保たれ、後の保守性が向上する。

---

## 担当者

| 役割 | 担当 |
|------|------|
| 主導 | AG（建築家） |
| 承認 | User（施主） |

---

## 前提条件

- [ ] Phase 2 が完了していること
- [ ] `docs/tech-stack.md` が存在すること
- [ ] `PRODUCT.md` の Current Phase が Phase 3 であること

---

## 対話フロー

### Round 1: 必要なガイドラインの判定

`docs/requirements.md` と `docs/tech-stack.md` を読み込み、このプロジェクトに必要なガイドラインを判定する。

---

#### 1.1 必須ガイドライン（どのプロジェクトでも）

| ガイドライン | 内容 |
|--------------|------|
| コーディングスタイル | ESLint/Prettier設定、インデント、セミコロン等 |
| 命名規則 | 変数、関数、ファイル、コンポーネントの命名ルール |
| Git運用 | コミットメッセージ規約、ブランチ戦略 |

---

#### 1.2 要件から導出されるガイドライン

`requirements.md` の非機能要件を確認し、必要なガイドラインを判定：

| 非機能要件 | 決定内容 | 必要なガイドライン |
|------------|---------|-------------------|
| テスト | E2E/ユニット | テストガイドライン（何をどこまでテストするか） |
| テスト | 手動のみ | 不要 |
| a11y | WCAG対応 | アクセシビリティガイドライン |
| a11y | 最低限 | 不要（セマンティックHTML程度） |
| i18n | 初期対応/将来検討 | テキスト管理ガイドライン |
| i18n | 不要 | 不要 |
| SEO | 本格対応 | メタ情報ガイドライン |
| SEO | 基本/不要 | 不要 |
| エラー監視 | Sentry等 | エラーハンドリングガイドライン |

---

#### 1.3 技術スタックから導出されるガイドライン

`tech-stack.md` の選定技術を確認し、必要なガイドラインを判定：

| 技術 | 必要なガイドライン |
|------|-------------------|
| React/Next.js | コンポーネント記述ルール（FC vs function、hooks規約等） |
| TypeScript | 型定義ガイドライン（any禁止、型の置き場所等） |
| Tailwind CSS | クラス記述順、カスタムクラス規約 |
| CSS Modules | スタイルファイルの配置ルール |
| Prisma/Drizzle | スキーマ定義ルール |
| tRPC/GraphQL | API定義ルール |

---

### Round 2: ユーザーの好みを確認

導出したガイドライン候補を提示し、ユーザーに確認：

> 「このプロジェクトでは以下のガイドラインが必要そうです」
> 「特に重視したいルールや、逆に避けたいルールはありますか？」
> 「既に慣れているスタイルガイドがあれば教えてください」

---

### Round 3: ガイドライン文書の作成

合意したガイドラインを文書化する。

**ファイル構成の例：**
- `docs/guidelines/coding.md` ← 必須
- `docs/guidelines/testing.md` ← テスト要件がある場合
- `docs/guidelines/accessibility.md` ← a11y要件がある場合
- その他、必要に応じて

---

## AGからの提案ルール

### 提案時の考慮事項

1. **シンプルを優先**
   - 個人開発であることを忘れない
   - 過度に厳格なルールは避ける

2. **ツールで強制できるものを優先**
   - Prettier, ESLint 等で自動化
   - 人間が覚える必要があるルールは最小限に

3. **業界標準を参考に**
   - 奇抜なルールは避ける
   - 検索しやすさを考慮

4. **設計との二重管理を避ける**
   - ディレクトリ構成、コンポーネント設計等はPhase 4で扱う
   - ガイドラインは「どう書くか」のルールに絞る

---

## 成果物

| ファイル | 説明 | 必須 |
|---------|------|------|
| `docs/guidelines/coding.md` | コーディングガイドライン | ○ |
| `docs/guidelines/testing.md` | テストガイドライン | テスト要件時 |
| `docs/guidelines/accessibility.md` | a11yガイドライン | a11y要件時 |
| `docs/guidelines/i18n.md` | テキスト管理ガイドライン | i18n要件時 |
| その他 | プロジェクトに応じて | - |

---

## CCレビュー（Claude Code による検証）

成果物作成後、Claude Code でレビューを実施する。

### 実行コマンド

```bash
claude -p "以下のファイルをレビューしてください。
対象: docs/guidelines/coding.md

レビュー観点:
1. 誤字脱字がないか
2. リスクがないか
3. 記載内容に不備がないか（漏れている情報がないか）
4. 技術的にあり得ないことを言っていないか
5. 職人としての目線で見て、全体的に問題がないドキュメントになっているか

問題があれば具体的に指摘してください。"
```

### レビュー結果の扱い

> ⚠️ **CCの指摘を鵜呑みにしないこと**
> Claude Code も AI なので、必ずしも正しい指摘とは限らない。

1. CCからの指摘を受け取る
2. **AGが指摘の妥当性を検証**する
   - 本当に問題か？
   - 修正が必要か？
   - 過剰な指摘ではないか？
3. 妥当な指摘のみ修正を実施
4. 判断に迷う場合はユーザーに相談

---

## 完了条件

### 必須条件
- [ ] `docs/guidelines/coding.md` が作成されている
- [ ] CCレビューが完了している
- [ ] ユーザーがガイドラインを承認している

### 追加確認
- [ ] 要件・技術スタックから導出されるガイドラインが作成済み
- [ ] ESLint/Prettier等の設定ファイルが整備されている（または設定内容が明記）

---

## 次フェーズへの移行

1. `PRODUCT.md` の `Current Phase` を「Phase 4: 設計」に更新
2. `Status & Decisions` にガイドライン策定完了を記録
3. Phase 4 ワークフロー（`/phase-4-design`）を開始
