---
description: Phase 4.0 基本設計 - システム概要・アーキテクチャ設計と必要な設計書の判定
---

# Phase 4.0: 基本設計ワークフロー

## 目的・概要

このフェーズでは、Phase 1〜3 で確定した要件・技術・ガイドラインに基づいて、**基本設計書**を作成し、プロジェクト全体の「必要な設計書一覧」を決定する。

基本設計書は実装の「土台」となる。後続のフェーズ（データ設計、API設計、画面設計）すべてがこの設計書を参照する。

---

## 担当者

| 役割 | 担当 |
|------|------|
| 主導 | AG（建築家） |
| 承認 | User（施主） |

---

## 前提条件

- [ ] Phase 3 が完了していること
- [ ] `docs/guidelines/coding.md` が存在すること
- [ ] `PRODUCT.md` の Current Phase が Phase 4.0 であること

---

## Step 1: 要件・技術スタックの確認

以下のドキュメントを読み込み、プロジェクトの全体像を把握する：

1. `docs/requirements.md` - 機能要件・非機能要件
2. `docs/tech-stack.md` - 採用技術
3. `docs/guidelines/*.md` - コーディングガイドライン

---

## Step 2: 必要な設計書の判定

要件に基づいて、このプロジェクトで必要な設計書を特定する。

### 標準の設計書（Ph4.1〜4.4で対応）

| 設計書 | 条件 | 対応フェーズ |
|--------|------|-------------|
| データ設計書 | DB/ファイル/キャッシュ使用時 | Ph4.1 |
| API設計書 | API有りの場合 | Ph4.2 |
| 画面設計書 | UI有りの場合 | Ph4.3, Ph4.4 |

### 追加の設計書が必要な場合

以下のような設計書が必要と判断された場合は、**ユーザーに通知して対応方針を相談**すること：

- 外部連携設計（サードパーティAPI、Webhook、OAuth等）
- セキュリティ設計（認証/認可、暗号化）
- メッセージング設計（キュー、イベント駆動）
- バッチ処理設計（定期実行ジョブ）
- インフラ設計（クラウド構成、ネットワーク）
- ログ・監視設計
- データ移行設計
- その他

> **⚠️ 重要**: Ph4.1〜4.4に該当しない設計書が必要な場合は、必ずユーザーに「〇〇設計書が必要そうですが、どう対応しますか？」と確認すること。

---

## Step 3: ユーザーとの対話

以下の観点でユーザーと対話しながら基本設計を固める：

### 3.1 システム概要

- プロジェクトの目的・背景
- 解決する課題
- 主要なユースケース

### 3.2 アーキテクチャ

- 全体構成（フロントエンド、バックエンド、DB、外部サービス等）
- 技術構成の詳細（tech-stack.md をベースに）
- デプロイ構成

### 3.3 データフロー

- 主要ユースケースのデータの流れ

### 3.4 非機能要件の設計方針

- パフォーマンス要件への対応策
- セキュリティ対策
- スケーラビリティ
- 可用性・信頼性

### 3.5 技術的制約・前提条件

- 外部サービスの制約
- 予算・リソースの制約
- 既存システムとの互換性

---

## Step 4: Implementation Plan 作成

対話で設計内容が固まったら、実装計画を作成してユーザー承認を得る。

### 実装計画の必須項目

```markdown
# Ph4.0 基本設計 - 実装計画

## 設計概要
（対話で固まった内容のサマリー）

## このプロジェクトで必要な設計書

| 設計書 | 必要性 | 理由 | 対応フェーズ |
|--------|--------|------|-------------|
| 基本設計 | 必須 | - | Ph4.0（これ） |
| データ設計 | ○/× | ... | Ph4.1 |
| API設計 | ○/× | ... | Ph4.2 |
| 画面設計 | ○/× | ... | Ph4.3, 4.4 |
| その他 | ○/× | ... | 要相談 |

## 出力ファイル構成

- `docs/design/index.md` - 設計書全体の目次・参照マップ
- `docs/design/basic-design.md` - 基本設計書（メイン）
- （必要に応じて分割ファイル）

## 基本設計書の目次案

1. システム概要
2. アーキテクチャ
3. データフロー
4. 非機能要件への対応
5. 技術的制約・前提条件
```

---

## Step 5: 基本設計書の作成

ユーザー承認後、以下のファイルを作成する：

### 5.1 `docs/design/index.md`

設計書全体の目次と参照マップ：

```markdown
# 設計書インデックス

## 設計書一覧

| 設計書 | パス | 状態 |
|--------|------|------|
| 基本設計書 | [basic-design.md](./basic-design.md) | ✅ 完了 |
| データ設計書 | [db/](./db/) | ⏳ Ph4.1で作成 |
| API設計書 | [api/](./api/) | ⏳ Ph4.2で作成 |
| 画面設計書 | [screens/](./screens/) | ⏳ Ph4.3, 4.4で作成 |

## 参照マップ

（Ph4.1以降で追記）
```

### 5.2 `docs/design/basic-design.md`

```markdown
# 基本設計書

## 1. システム概要

### 1.1 プロジェクトの目的
（対話で確定した内容）

### 1.2 解決する課題
...

### 1.3 主要なユースケース
...

## 2. アーキテクチャ

### 2.1 全体構成図

（Mermaid図を含む）

### 2.2 技術構成

| レイヤー | 技術 | 役割 |
|---------|------|------|
| フロントエンド | ... | ... |
| バックエンド | ... | ... |
| データベース | ... | ... |
| インフラ | ... | ... |

### 2.3 デプロイ構成
...

## 3. データフロー

### 3.1 主要ユースケースのフロー

（シーケンス図やフローチャート）

## 4. 非機能要件への対応

### 4.1 パフォーマンス
...

### 4.2 セキュリティ
...

### 4.3 スケーラビリティ
...

## 5. 技術的制約・前提条件

### 5.1 外部サービスの制約
...

### 5.2 予算・リソースの制約
...
```

---

## Step 6: CCレビュー

基本設計書完成後、Claude Code にレビューを依頼する。

```bash
claude -p "以下のファイルをレビューしてください。
対象: docs/design/basic-design.md

レビュー観点:
1. 誤字脱字がないか
2. 曖昧な表現がないか（実装時に迷う記述）
3. 技術的に矛盾した記載がないか
4. 記載漏れがないか
5. 要件定義書（docs/requirements.md）との乖離がないか

問題があれば具体的に指摘してください。"
```

---

## 完了条件

- [ ] `docs/design/index.md` が作成されている
- [ ] `docs/design/basic-design.md` が作成されている
- [ ] 「必要な設計書一覧」が確定している
- [ ] CCレビューが完了している
- [ ] ユーザーが基本設計書を承認している

---

## 次フェーズへの移行

1. `PRODUCT.md` の `Current Phase` を次のフェーズに更新
   - データ設計が必要 → 「Phase 4.1: データ設計」
   - データ設計不要でAPI設計が必要 → 「Phase 4.2: API設計」
   - データ/API設計不要で画面設計が必要 → 「Phase 4.3: 画面設計」
2. `Status & Decisions` に基本設計完了を記録
3. 次のワークフローを開始
