---
description: Phase 6-8 実装・検証 - 1つのサブタスクを完了させる
---

# Phase 6-8: 実装・検証ワークフロー

## 目的・概要

このフェーズでは、Jira のサブタスク1つを**スタートからゴール**まで完了させる。

全サブタスクを完了させるには、ユーザーがこのワークフローを繰り返し実行する。

---

## 担当者

| 役割 | Step |
|------|------|
| AG | タスク確認、実装計画、コードレビュー、Jira更新 |
| CC | 計画レビュー、TDD実装、コミット |

> [!IMPORTANT]
> **CCはこのワークフローを読み込まない**
>
> CCはAGが作成した**実装計画ファイル**（`docs/plans/[タスクID]-plan.md`）に基づいて作業する。
> AGはCCに任せる作業について、実装計画内で**正確かつ詳細に指示**を記述すること。

---

## 前提条件

- [ ] Phase 5 が完了していること
- [ ] `docs/setup.md` が存在し、環境構築が完了していること
- [ ] Jira に親タスク・サブタスクが登録されていること
- [ ] `PRODUCT.md` の Current Phase が Phase 6 以降であること
- [ ] `PRODUCT.md` に Jira プロジェクトキーが記載されていること

---

## Step 9: タスク確認

AGがJiraから次のサブタスクを確認する。

### 手順

1. `PRODUCT.md` から Jira プロジェクトキーを確認
2. Jira の親タスクを確認
3. 未完了のサブタスクを特定
4. 着手するサブタスクを決定
5. **タスクの開始条件（前提条件）を確認**
   - 開始条件が満たされていない場合は、先に対応が必要な作業を特定

> ユーザーに「次のタスクは [タスク名] です。開始条件を確認しました。着手してよいですか？」と確認

---

## Step 10: 実装計画の策定（TDD原則）

AGが `docs/_templates/implementation-plan.md` を使用して実装計画を作成し、
`docs/plans/[タスクID]-plan.md` に保存する。

### 計画作成の前提

1. **タスクの受入条件（完了定義）を確認**
   - Jira チケットに記載された受入条件を読み込む
   - 受入条件を満たすことがゴール

2. **タスクの目的・背景を確認**
   - なぜこのタスクが必要かを理解した上で計画を立てる

3. **関連する設計書を確認**
   - `docs/design/index.md` の参照マップから関連を特定
   - API設計: `docs/design/api/[resource].md`
   - DB設計: `docs/design/db/[table].md`
   - 画面設計: `docs/design/screens/[screen]/design.md`

4. **ガイドラインを確認**
   - `docs/guidelines/coding.md`
   - その他必要なガイドライン（testing.md, accessibility.md 等）

### 実装計画に含める必須項目

```markdown
# [タスクID] 実装計画

## 概要
- タスク名: xxx
- Jira: [リンク]
- 受入条件: xxx

## 参照ドキュメント（根拠）

> ⚠️ CCはこのセクションのファイルを必ず確認すること

| 種別 | パス | 参照箇所 |
|------|------|----------|
| API設計 | docs/design/api/recipes.md | GET /api/recipes/{id} |
| DB設計 | docs/design/db/recipes.md | カラム定義 |
| 画面設計 | docs/design/screens/recipe-detail/design.md | 表示項目・操作 |
| ガイドライン | docs/guidelines/coding.md | 命名規則・コードスタイル |

## テストシナリオ
...

## 実装手順
...
```

### TDD原則に則った構成

1. **テストシナリオを先に定義**
   - 受入条件をテストケースに落とし込む
   - 期待する入力と出力
   - 正常系・異常系のケース

2. **実装手順**
   - 各テストを通すための最小限の実装

3. **リファクタリング観点**
   - 実装後に改善すべき点

---

## Step 11: 計画レビュー（CC）

Claude Code に実装計画ファイルをレビューさせる。

```bash
claude -p "docs/plans/[タスクID]-plan.md を読み込んで、
職人の視点で不備やリスクを指摘してください。"
```

> ⚠️ CCの指摘を鵜呑みにしない。AGが妥当性を検証。

---

## Step 12: 自律的TDD（CC）

Claude Code に実装計画ファイルを読ませてTDD実装させる。

```bash
claude -p "docs/plans/[タスクID]-plan.md を読み込んで、
TDD形式で実装してください。

1. まず失敗するテストを書く
2. テストを通す最小限のコードを書く
3. リファクタリング" --dangerously-skip-permissions
```

---

## Step 13: コードレビュー（AG）

AGが実装されたコードをレビュー。

### レビュー観点

- 設計書（`docs/design/*`）との乖離がないか
- コーディングガイドライン（`docs/guidelines/coding.md`）に準拠しているか
- テストカバレッジは十分か
- 受入条件を満たしているか

問題があれば修正を指示。

---

## Step 14: コミット + Jira更新

### コミット

```bash
git add .
git commit -m "feat(scope): タスク内容"
```

### Jira更新

- サブタスクのステータスを「**完了**」に更新
- 全サブタスク完了時は親タスクも「**完了**」に

---

## セッション終了時（未完了の場合）

サブタスクを完了できずにセッションが終了する場合：

1. Jira サブタスクに**コメント**を追加
   ```
   ### 進捗
   - ○○まで完了
   - △△は未着手

   ### 次回やること
   - □□の実装

   ### ブロッカー（あれば）
   - ××の仕様が不明
   ```

2. 次回セッションで引き継ぎ可能な状態にする

---

## 中断・相談

重大な問題が発生した場合：

1. 作業を一時停止
2. `docs/opinions/opinion_from_claude.md` を作成（CCの場合）
3. ユーザーに相談

> これは例外的なケースで、通常は発生しない

---

## 完了条件

- [ ] タスクの**受入条件**を満たしている
- [ ] サブタスクの実装が完了している
- [ ] テストがパスしている
- [ ] コードレビューが完了している
- [ ] コミットが完了している
- [ ] Jira ステータスが更新されている

---

## 次のサブタスクへ

ユーザーがこのワークフロー（`/phase-6-implementation`）を再度実行する。

全サブタスク完了後は、完了・維持フェーズへ移行。
